{% extends 'hostels/base.html' %}
{% load static %}

{% block title %}List Your Hostel - StudentStay{% endblock %}

{% block extra_css %}
<style>
    .create-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 100px 0 50px;
        margin-top: -76px;
    }
    
    .form-section {
        background: white;
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #f1f2f6;
    }
    
    .section-header {
        border-bottom: 2px solid #f1f2f6;
        padding-bottom: 15px;
        margin-bottom: 30px;
    }
    
    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    .form-floating label {
        color: #6c757d;
    }
    
    .form-floating > .form-control:focus,
    .form-floating > .form-control:not(:placeholder-shown) {
        padding-top: 1.625rem;
        padding-bottom: 0.625rem;
    }
    
    .form-floating > label {
        padding: 1rem 1rem;
    }
    
    .amenity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .amenity-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border: 2px solid #f1f2f6;
        border-radius: 10px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .amenity-item:hover {
        border-color: #667eea;
        background: #f8f9ff;
    }
    
    .amenity-item input[type="checkbox"] {
        margin-right: 12px;
        transform: scale(1.2);
    }
    
    .amenity-item input[type="checkbox"]:checked + label {
        color: #667eea;
        font-weight: 500;
    }
    
    .image-upload-section {
        border: 2px dashed #d1d5db;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        transition: all 0.3s ease;
        background: #fafbfc;
        margin: 20px 0;
    }
    
    .image-upload-section:hover {
        border-color: #667eea;
        background: #f8f9ff;
    }
    
    .image-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .preview-item {
        position: relative;
        aspect-ratio: 4/3;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .preview-remove {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(220, 53, 69, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .preview-remove:hover {
        background: #dc3545;
        transform: scale(1.1);
    }
    
    .form-help {
        font-size: 14px;
        color: #6c757d;
        margin-top: 5px;
    }
    
    .required-field::after {
        content: '*';
        color: #dc3545;
        margin-left: 4px;
    }
    
    .form-check-custom {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        transition: all 0.3s ease;
    }
    
    .form-check-custom:hover {
        background: #e9ecef;
    }
    
    .form-check-custom input[type="checkbox"]:checked ~ label {
        color: #667eea;
        font-weight: 500;
    }
    
    .submit-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        color: white;
        margin: 40px 0;
    }
    
    .btn-submit {
        background: white;
        color: #667eea;
        border: none;
        padding: 15px 40px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .btn-submit:hover {
        background: #f8f9fa;
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        color: #5a67d8;
    }
    
    .progress-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin: 30px 0;
    }
    
    .progress-step {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-weight: 600;
        position: relative;
    }
    
    .progress-step.active {
        background: #667eea;
        color: white;
    }
    
    .progress-step.completed {
        background: #28a745;
        color: white;
    }
    
    .progress-line {
        width: 50px;
        height: 2px;
        background: #e9ecef;
    }
    
    .progress-line.completed {
        background: #28a745;
    }

    .pricing-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .pricing-card {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .pricing-card:hover {
        border-color: #667eea;
        background: #f8f9ff;
    }

    .pricing-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        margin-bottom: 15px;
    }

    .input-group-text {
        background: #f8f9fa;
        border-color: #e9ecef;
        color: #6c757d;
        font-weight: 500;
    }

    .input-group .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .validation-message {
        font-size: 13px;
        margin-top: 5px;
        padding: 8px 12px;
        border-radius: 8px;
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border-left: 3px solid #dc3545;
        display: none;
    }

    .validation-message.show {
        display: block;
    }
    
    @media (max-width: 768px) {
        .create-header {
            padding: 80px 0 30px;
        }
        
        .form-section {
            padding: 25px;
            border-radius: 15px;
        }
        
        .amenity-grid {
            grid-template-columns: 1fr;
        }
        
        .progress-nav {
            gap: 10px;
        }
        
        .progress-line {
            width: 30px;
        }
        
        .progress-step {
            width: 35px;
            height: 35px;
            font-size: 14px;
        }

        .pricing-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="create-header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="display-5 fw-bold mb-3">List Your Hostel</h1>
                <p class="lead mb-4">Join thousands of property owners earning with StudentStay</p>
                
                <!-- Progress Navigation -->
                <div class="progress-nav">
                    <div class="progress-step active">1</div>
                    <div class="progress-line"></div>
                    <div class="progress-step">2</div>
                    <div class="progress-line"></div>
                    <div class="progress-step">3</div>
                    <div class="progress-line"></div>
                    <div class="progress-step">4</div>
                </div>
                <p class="small text-white-50">Basic Info → Rooms & Pricing → Photos → Room Types</p>
            </div>
        </div>
    </div>
</section>

<!-- Main Form -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <form method="post" enctype="multipart/form-data" id="hostelForm">
                {% csrf_token %}
                
                <!-- Basic Information Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <span class="required-field">Basic Information</span>
                        </div>
                        <p class="text-muted mb-0">Tell us about your property</p>
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.name }}
                                <label for="{{ form.name.id_for_label }}" class="required-field">Hostel Name</label>
                            </div>
                            {% if form.name.errors %}
                                <div class="text-danger small mt-1">{{ form.name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.school }}
                                <label for="{{ form.school.id_for_label }}" class="required-field">School/University</label>
                            </div>
                            {% if form.school.errors %}
                                <div class="text-danger small mt-1">{{ form.school.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.campus }}
                                <label for="{{ form.campus.id_for_label }}">Campus</label>
                            </div>
                            <div class="form-help">e.g., Main Campus, North Campus</div>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label required-field">Description</label>
                            {{ form.description }}
                            <div class="form-help">Describe your hostel, its features, and what makes it special</div>
                            {% if form.description.errors %}
                                <div class="text-danger small mt-1">{{ form.description.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Rooms & Pricing Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-bed"></i>
                            </div>
                            <span class="required-field">Rooms & Pricing Overview</span>
                        </div>
                        <p class="text-muted mb-0">Basic room and pricing information (you'll add detailed room types later)</p>
                    </div>
                    
                    <div class="pricing-grid">
                        <div class="pricing-card">
                            <div class="pricing-icon">
                                <i class="fas fa-door-open"></i>
                            </div>
                            <h6 class="mb-3">Room Count</h6>
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="input-group">
                                        <span class="input-group-text">Total</span>
                                        {{ form.total_rooms }}
                                    </div>
                                    {% if form.total_rooms.errors %}
                                        <div class="text-danger small mt-1">{{ form.total_rooms.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-12">
                                    <div class="input-group">
                                        <span class="input-group-text">Available</span>
                                        {{ form.available_rooms }}
                                    </div>
                                    {% if form.available_rooms.errors %}
                                        <div class="text-danger small mt-1">{{ form.available_rooms.errors.0 }}</div>
                                    {% endif %}
                                    <div id="roomCountValidation" class="validation-message">
                                        Available rooms cannot exceed total rooms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="pricing-card">
                            <div class="pricing-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h6 class="mb-3">Price Range (per person)</h6>
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="input-group">
                                        <span class="input-group-text">GH₵</span>
                                        {{ form.min_price }}
                                        <span class="input-group-text">Min</span>
                                    </div>
                                    {% if form.min_price.errors %}
                                        <div class="text-danger small mt-1">{{ form.min_price.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-12">
                                    <div class="input-group">
                                        <span class="input-group-text">GH₵</span>
                                        {{ form.max_price }}
                                        <span class="input-group-text">Max</span>
                                    </div>
                                    {% if form.max_price.errors %}
                                        <div class="text-danger small mt-1">{{ form.max_price.errors.0 }}</div>
                                    {% endif %}
                                    <div id="priceRangeValidation" class="validation-message">
                                        Maximum price must be greater than or equal to minimum price
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> These are overview numbers. After creating your hostel, you'll be able to add specific room types with detailed pricing and features.
                    </div>
                </div>
                
                <!-- Contact Information Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <span class="required-field">Contact Information</span>
                        </div>
                        <p class="text-muted mb-0">How students can reach you</p>
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.phone_number }}
                                <label for="{{ form.phone_number.id_for_label }}" class="required-field">Phone Number</label>
                            </div>
                            {% if form.phone_number.errors %}
                                <div class="text-danger small mt-1">{{ form.phone_number.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.email }}
                                <label for="{{ form.email.id_for_label }}">Email Address</label>
                            </div>
                            <div class="form-help">Optional - for email inquiries</div>
                            {% if form.email.errors %}
                                <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Location Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <span class="required-field">Location Details</span>
                        </div>
                        <p class="text-muted mb-0">Where is your hostel located?</p>
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-12">
                            <label class="form-label required-field">Full Address</label>
                            {{ form.address }}
                            <div class="form-help">Include street address, area, and any landmarks</div>
                            {% if form.address.errors %}
                                <div class="text-danger small mt-1">{{ form.address.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.latitude }}
                                <label for="{{ form.latitude.id_for_label }}">Latitude</label>
                            </div>
                            <div class="form-help">Optional - for map location</div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.longitude }}
                                <label for="{{ form.longitude.id_for_label }}">Longitude</label>
                            </div>
                            <div class="form-help">Optional - for map location</div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Information Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <span class="required-field">Payment Information</span>
                        </div>
                        <p class="text-muted mb-0">Bank details for payments</p>
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.account_name }}
                                <label for="{{ form.account_name.id_for_label }}" class="required-field">Account Name</label>
                            </div>
                            {% if form.account_name.errors %}
                                <div class="text-danger small mt-1">{{ form.account_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating">
                                {{ form.bank_name }}
                                <label for="{{ form.bank_name.id_for_label }}">Bank Name</label>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="form-floating">
                                {{ form.account_number }}
                                <label for="{{ form.account_number.id_for_label }}">Account Number</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Image Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <span>Main Photo</span>
                        </div>
                        <p class="text-muted mb-0">Upload your best photo - this will be shown first</p>
                    </div>
                    
                    <div class="image-upload-section">
                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                        <h5>Upload Main Photo</h5>
                        <p class="text-muted">Choose your best exterior or interior shot</p>
                        {{ form.main_image }}
                        <div class="form-help">Recommended: 1200x800px, JPG or PNG, max 5MB</div>
                    </div>
                    
                    <div id="mainImagePreview" class="image-preview d-none">
                        <!-- Preview will be inserted here -->
                    </div>
                </div>
                
                <!-- Additional Images Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-images"></i>
                            </div>
                            <span>Photo Gallery</span>
                        </div>
                        <p class="text-muted mb-0">Add more photos to showcase your hostel</p>
                    </div>
                    
                    <div class="image-formset">
                        {{ image_formset.management_form }}
                        
                        <div id="image-forms">
                            {% for form_item in image_formset %}
                                <div class="image-form-item border rounded p-3 mb-3">
                                    <div class="row g-3 align-items-end">
                                        <div class="col-md-4">
                                            <label class="form-label">Image</label>
                                            {{ form_item.image }}
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                {{ form_item.caption }}
                                                <label for="{{ form_item.caption.id_for_label }}">Caption (Optional)</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-floating">
                                                {{ form_item.order }}
                                                <label for="{{ form_item.order.id_for_label }}">Order</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% if form_item.DELETE %}
                                        <div class="form-check mt-2">
                                            {{ form_item.DELETE }}
                                            <label class="form-check-label text-danger" for="{{ form_item.DELETE.id_for_label }}">
                                                Delete this image
                                            </label>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Amenities Section -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <span>Amenities & Features</span>
                        </div>
                        <p class="text-muted mb-0">What facilities do you offer?</p>
                    </div>
                    
                    <div class="form-check-custom">
                        {{ form.has_wifi }}
                        <label class="form-check-label" for="{{ form.has_wifi.id_for_label }}">
                            <i class="fas fa-wifi me-2 text-primary"></i>
                            <strong>WiFi Internet</strong>
                            <div class="small text-muted">Free wireless internet access</div>
                        </label>
                    </div>
                    
                    <div class="amenity-grid">
                        {% for choice in form.amenities %}
                            <div class="amenity-item">
                                {{ choice.tag }}
                                <label class="form-check-label" for="{{ choice.id_for_label }}">
                                    {{ choice.choice_label }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div class="submit-section">
                    <h3 class="mb-3">Ready to Create Your Hostel?</h3>
                    <p class="mb-4">After creating your hostel, you'll be guided to add specific room types and their details</p>
                    
                    <div class="d-flex gap-3 justify-content-center">
                        <a href="{% url 'hostels:hostel_list' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-submit btn-lg">
                            <i class="fas fa-plus me-2"></i>Create Hostel & Continue
                        </button>
                    </div>
                    
                    <div class="small mt-3 text-white-50">
                        Next: Add room types, set detailed pricing, and configure room-specific features
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Main image preview
    const mainImageInput = document.querySelector('input[name="main_image"]');
    const mainImagePreview = document.getElementById('mainImagePreview');
    
    mainImageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                mainImagePreview.innerHTML = `
                    <div class="preview-item">
                        <img src="${e.target.result}" alt="Main image preview">
                        <button type="button" class="preview-remove" onclick="removeMainImage()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                mainImagePreview.classList.remove('d-none');
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Real-time validation for room counts and pricing
    const totalRoomsInput = document.querySelector('input[name="total_rooms"]');
    const availableRoomsInput = document.querySelector('input[name="available_rooms"]');
    const minPriceInput = document.querySelector('input[name="min_price"]');
    const maxPriceInput = document.querySelector('input[name="max_price"]');
    
    function validateRoomCounts() {
        const totalRooms = parseInt(totalRoomsInput.value) || 0;
        const availableRooms = parseInt(availableRoomsInput.value) || 0;
        const validationMsg = document.getElementById('roomCountValidation');
        
        if (availableRooms > totalRooms && totalRooms > 0) {
            validationMsg.classList.add('show');
            availableRoomsInput.classList.add('is-invalid');
            return false;
        } else {
            validationMsg.classList.remove('show');
            availableRoomsInput.classList.remove('is-invalid');
            return true;
        }
    }
    
    function validatePriceRange() {
        const minPrice = parseFloat(minPriceInput.value) || 0;
        const maxPrice = parseFloat(maxPriceInput.value) || 0;
        const validationMsg = document.getElementById('priceRangeValidation');
        
        if (maxPrice < minPrice && minPrice > 0 && maxPrice > 0) {
            validationMsg.classList.add('show');
            maxPriceInput.classList.add('is-invalid');
            return false;
        } else {
            validationMsg.classList.remove('show');
            maxPriceInput.classList.remove('is-invalid');
            return true;
        }
    }
    
    // Add event listeners for real-time validation
    totalRoomsInput.addEventListener('input', validateRoomCounts);
    availableRoomsInput.addEventListener('input', validateRoomCounts);
    minPriceInput.addEventListener('input', validatePriceRange);
    maxPriceInput.addEventListener('input', validatePriceRange);
    
    // Form validation
    const form = document.getElementById('hostelForm');
    form.addEventListener('submit', function(e) {
        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');
        
        // Check required fields
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        // Check custom validations
        if (!validateRoomCounts()) {
            isValid = false;
        }
        
        if (!validatePriceRange()) {
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            // Scroll to first error
            const firstError = form.querySelector('.is-invalid, .validation-message.show');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Focus on the invalid field if it's an input
                if (firstError.tagName === 'INPUT' || firstError.tagName === 'TEXTAREA') {
                    setTimeout(() => firstError.focus(), 500);
                }
            }
            
            // Show error message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle me-2"></i>
                Please fix all errors before submitting. Check required fields and validation messages.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.container').insertAdjacentElement('afterbegin', alertDiv);
            
            // Auto dismiss after 7 seconds
            setTimeout(() => {
                if (alertDiv && alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 7000);
        } else {
            // Show loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating Hostel...';
        }
    });
    
    // Real-time validation for required fields
    const requiredInputs = form.querySelectorAll('[required]');
    requiredInputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });
        
        input.addEventListener('input', function() {
            if (this.classList.contains('is-invalid') && this.value.trim()) {
                this.classList.remove('is-invalid');
            }
        });
    });
    
    // Auto-resize textareas
    const textareas = form.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    });
    
    // Number input formatting
    const priceInputs = [minPriceInput, maxPriceInput];
    priceInputs.forEach(input => {
        input.addEventListener('input', function() {
            // Remove non-numeric characters except decimal point
            let value = this.value.replace(/[^0-9.]/g, '');
            
            // Ensure only one decimal point
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Limit to 2 decimal places
            if (parts[1] && parts[1].length > 2) {
                value = parseFloat(value).toFixed(2);
            }
            
            this.value = value;
        });
    });
    
    // Room count input validation
    const roomInputs = [totalRoomsInput, availableRoomsInput];
    roomInputs.forEach(input => {
        input.addEventListener('input', function() {
            // Remove non-numeric characters
            this.value = this.value.replace(/[^0-9]/g, '');
            
            // Ensure minimum value of 0
            if (parseInt(this.value) < 0) {
                this.value = '0';
            }
        });
    });
});

function removeMainImage() {
    document.querySelector('input[name="main_image"]').value = '';
    document.getElementById('mainImagePreview').classList.add('d-none');
    document.getElementById('mainImagePreview').innerHTML = '';
}
</script>
{% endblock %}